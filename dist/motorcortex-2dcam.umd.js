!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@donkeyclip/motorcortex")):"function"==typeof define&&define.amd?define(["@donkeyclip/motorcortex"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["@donkeyclip/motorcortex-2dcam"]=e(t.MotorCortex)}(this,(function(t){"use strict";class e{constructor(t){this.el=t,this.matrix=this.getMatrix(t),this.viewportCenter=this.getViewPortCenter(),this.idlePosition=this.getIdlePosition()}getMatrix(t){return function(t){const e=window.getComputedStyle(t).transform;return""===e||"none"===e?{rotate:"0deg",scaleX:1,scaleY:1,skewX:"0deg",skewY:"0deg",translateX:"0px",translateY:"0px"}:function(t){const e=Math.atan2(t[1],t[0]),o=Math.pow(t[0],2)+Math.pow(t[1],2),a=Math.pow(t[2],2)+Math.pow(t[3],2),n=Math.sqrt(o),i=(t[0]*t[3]-t[2]*t[1])/n,s=Math.atan2(t[0]*t[2]+t[1]*t[3],o),r=Math.atan2(t[1]*t[3]+t[0]*t[2],a);return{rotate:e/(Math.PI/180)+"deg",scaleX:n,scaleY:i,skewX:(1===o?s/(Math.PI/180):0)+"deg",skewY:(1===a?r/(Math.PI/180):0)+"deg",translateX:t[4]+"px",translateY:t[5]+"px"}}(e.split("(")[1].split(")")[0].split(","))}(t)}getViewPortCenter(){const t=this.el.parentNode;return{x:parseFloat(getComputedStyle(t,null).width.replace("px",""))/2,y:parseFloat(getComputedStyle(t,null).height.replace("px",""))/2}}getIdlePosition(){const t=this.el,e=t.getBoundingClientRect(),o=t.parentNode.getBoundingClientRect();return{x:e.left-o.left,y:e.top-o.top}}calcXYZoom(){const t=this.matrix,e=this.idlePosition,o=this.viewportCenter,a=o.x-e.x,n=o.y-e.y;return{...{x:a/t.scaleX,y:n/t.scaleY},zoom:t.scaleX}}createProgressFunction(t){const e=this._xyzoomToTranslate(t.start),o=this._xyzoomToTranslate(t.target),a=Math.atan(Math.abs(o.y-e.y)/Math.abs(o.x-e.x)),n=Math.sqrt(Math.pow(o.y-e.y,2)+Math.pow(o.x-e.x,2));let i=1,s=1;return o.x<e.x&&(i=-1),o.y<e.y&&(s=-1),function(t){const r=t*n;return{translateX:i*r*Math.cos(a)+e.x,translateY:s*r*Math.sin(a)+e.y,scale:(o.scale-e.scale)*t+e.scale}}}_xyzoomToTranslate(t){const e=t.zoom*t.x,o=t.zoom*t.y,a=this.viewportCenter.x-e,n=this.viewportCenter.y-o;return{x:a-this.idlePosition.x,y:n-this.idlePosition.y,scale:t.zoom}}createPathProgressFunction(t,e){let o=t=>{};t.transitionDuration>0&&(o=this.createProgressFunction({start:e,target:{x:t.startPoint.x,y:t.startPoint.y,zoom:e.zoom}}));const a=t.transitionDuration/(t.transitionDuration+t.alongPathDuration),n=t.alongPathDuration/(t.transitionDuration+t.alongPathDuration),i=(t.endTo-t.startFrom)*t.pathLength;return s=>{if(t.transitionDuration>0&&s<a)return o(s/a);const r=(s-a)/n,l=(t.zoom-e.zoom)*r+e.zoom,h=r*i+t.startFrom*t.pathLength,p=t.path.getPointAtLength(h),c=this._xyzoomToTranslate({x:p.x,y:p.y,zoom:l});return{translateX:c.x,translateY:c.y,scale:c.scale}}}}class o extends t.Effect{getScratchValue(){return this.adaptor=new e(this.element),this.adaptor.calcXYZoom()}onGetContext(){this.adaptor=new e(this.element),this.progressMethod=this.adaptor.createProgressFunction({start:this.initialValue,target:this.targetValue})}onProgress(t){const e=this.progressMethod(this.getFraction(t));this.element.style.transform=`translateX(${e.translateX}px) translateY(${e.translateY}px) scaleX(${e.scale}) scaleY(${e.scale})`}}return{npm_name:"@donkeyclip/motorcortex-2dcam",version:"0.3.1",incidents:[{exportable:o,name:"ZoomTo",attributesValidationRules:{animatedAttrs:{type:"object",props:{position:{type:"object",props:{x:{type:"number",optional:!0,min:0},y:{type:"number",optional:!0,min:0},zoom:{type:"number",optional:!0,min:0}}}}}}},{exportable:class extends o{onInitialise(){const t=this.props.duration,e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttributeNS(null,"d",this.targetValue.path),this.data={path:e,finalPoint:null,startPoint:null,zoom:this.targetValue.zoom,pathLength:e.getTotalLength(),startFrom:this.attrs.from?this.attrs.from:0,endTo:this.attrs.to?this.attrs.to:1,transitionDuration:this.attrs.transition?this.attrs.transition:0,get alongPathDuration(){return t-this.transitionDuration}},this.data.finalPoint=e.getPointAtLength(this.data.endTo*this.data.pathLength),this.data.startPoint=e.getPointAtLength(this.data.startFrom*this.data.pathLength),this.targetValue.x=this.data.finalPoint.x,this.targetValue.y=this.data.finalPoint.y}onGetContext(){this.adaptor=new e(this.element),this.data.zoom=this.targetValue.zoom,this.progressMethod=this.adaptor.createPathProgressFunction(this.data,this.initialValue)}},name:"FollowPath",attributesValidationRules:{animatedAttrs:{type:"object",props:{position:{type:"object",props:{path:{type:"string",optional:!1},zoom:{type:"number",optional:!0,min:0}}}}},transition:{type:"number",integer:!0,min:0,optional:!0},from:{type:"number",min:0,max:1,optional:!0},to:{type:"number",min:0,max:1,optional:!0}}}],compositeAttributes:{position:["x","y","zoom","path"]}}}));
